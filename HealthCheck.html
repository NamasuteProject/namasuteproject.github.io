<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MinecraftServer - ç¨¼åƒçŠ¶æ³</title>
    <style>
        /* --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOutDown { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(30px); } }
        
        .animate-in { animation: fadeInUp 0.8s ease-out both; }
        .animate-out { animation: fadeOutDown 0.4s ease-in both !important; }
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #1a1a1a; color: #e0e0e0;
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden; /* iframeå†…ã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼å¯¾ç­– */
        }

        .container {
            width: 90%; max-width: 600px; background: #2d2d2d; padding: 2.5rem;
            border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            border-top: 5px solid #ffa500;
        }

        h1 {
            font-size: 1.5rem; color: #ffa500; border-bottom: 2px solid #3d3d3d;
            padding-bottom: 0.5rem; display: flex; align-items: center;
        }
        h1::before { content: 'ğŸ“¡'; margin-right: 10px; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .status-card {
            background: #1e1e1e; padding: 25px; border-radius: 12px;
            margin: 1.5rem 0; display: flex; justify-content: space-between;
            align-items: center; border: 1px solid #3d3d3d;
        }
        .indicator { font-weight: bold; padding: 8px 16px; border-radius: 6px; }
        .online { color: #81c784; background: rgba(129, 199, 132, 0.1); border: 1px solid #2e7d32; }
        .offline { color: #e57373; background: rgba(229, 115, 115, 0.1); border: 1px solid #c62828; }
        .player-count { font-size: 1.8rem; color: #fff; font-weight: bold; }

        /* --- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è©³ç´° --- */
        .detail-box {
            background: rgba(255, 165, 0, 0.1); border-left: 4px solid #ffa500;
            padding: 15px; margin: 1rem 0; border-radius: 4px; display: none;
        }
        .detail-box h3 { margin: 0 0 5px 0; font-size: 0.9rem; color: #ffa500; }
        .detail-box p { margin: 0; font-size: 0.95rem; line-height: 1.4; }

        /* --- ã‚³ãƒ”ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- */
        .copy-section {
            background: #252525; border-radius: 10px; padding: 15px;
            margin: 1.5rem 0; border: 1px dashed #555; cursor: pointer;
            transition: all 0.3s ease; position: relative; text-align: center;
        }
        .copy-section:hover { background: #333; border-color: #ffa500; }
        .ip-text { 
            display: block; font-family: 'Courier New', Courier, monospace; 
            font-size: 1.2rem; color: #ffa500; margin-bottom: 5px; 
        }
        .copy-hint { font-size: 0.75rem; color: #777; }

        .tooltip {
            position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
            background: #ffa500; color: #000; padding: 5px 12px; border-radius: 4px;
            font-size: 0.8rem; font-weight: bold; opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        .tooltip.show { opacity: 1; }

        .btn-back { display: block; text-align: center; margin-top: 1.5rem; color: #aaa; text-decoration: none; font-size: 0.9rem; cursor: pointer; }
        .btn-back:hover { color: #fff; }

        /* å°‘ã—é…ã‚‰ã›ã¦é–‹å§‹ã™ã‚‹ã“ã¨ã§ã€è¦ªãŒæ²ˆã‚€ã®ã¨å…¥ã‚Œæ›¿ã‚ã‚Šã§å‡ºã¦ãã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ */
        .animate-in { 
            animation: fadeInUp 0.6s ease-out both;
            animation-delay: 0.1s; 
        }
    </style>
</head>
<body>

<div class="container animate-in" id="health-container">
    <div class="animate-in delay-1">
        <h1>Server Status</h1>
        <p>ç¾åœ¨ã®ã‚µãƒ¼ãƒãƒ¼ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
    </div>
    
    <div class="status-card animate-in delay-2">
        <div>
            <div style="font-size: 0.8rem; color: #777; margin-bottom: 5px;">STATUS</div>
            <span id="server-status" class="indicator">ç¢ºèªä¸­...</span>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.8rem; color: #777; margin-bottom: 5px;">PLAYERS</div>
            <div class="player-count">
                <span id="player-online">-</span><span style="font-size: 1rem; color: #555;"> / </span><span id="player-max">-</span>
            </div>
        </div>
    </div>

    <div id="maintenance-detail" class="detail-box animate-in delay-2">
        <h3>ğŸ“‹ ç®¡ç†è€…ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
        <p id="detail-text"></p>
    </div>

    <div class="copy-section animate-in delay-2" onclick="copyIP()">
        <div id="tooltip" class="tooltip">Copied!</div>
        <span class="copy-hint">Click to Copy Server IP</span>
        <span id="server-ip-display" class="ip-text">namasutee.duckdns.org:3315</span>
        <span class="copy-hint">ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹</span>
    </div>

    <a href="javascript:void(0)" onclick="closePageWithAnimation()" class="btn-back animate-in delay-2">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>
</div>

<script>
    const serverIP = 'namasutee.duckdns.org:3315'; // â˜…DuckDNSã®ã‚¢ãƒ‰ãƒ¬ã‚¹

// å„å­ãƒšãƒ¼ã‚¸ã® closePageWithAnimation é–¢æ•°ï¼ˆå†ç¢ºèªç”¨ï¼‰
function closePageWithAnimation() {
    const container = document.querySelector('.container');
    container.classList.add('animate-out'); // ä¸‹ã«æ¶ˆãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    
    setTimeout(() => {
        if (window.parent && window.parent.closePage) {
            window.parent.closePage(); // è¦ªã® closePage() ã‚’å®Ÿè¡Œ
        }
    }, 350);
}

    async function getStatusWithFallback() {
        const timestamp = Date.now();
        const requests = [
            fetch(`https://api.mcsrvstat.us/3/${serverIP}?cache=${timestamp}`).then(res => res.json()),
            fetch(`https://mcapi.us/server/status?ip=${serverIP}&_=${timestamp}`).then(res => res.json())
        ];

        const results = await Promise.allSettled(requests);
        let bestResult = { online: false, players: 0, max: 0 };

        results.forEach(result => {
            if (result.status === 'fulfilled') {
                const data = result.value;
                if (data.online && data.players) {
                    const online = data.players.online !== undefined ? data.players.online : data.players.now;
                    if (online >= bestResult.players) {
                        bestResult = { online: true, players: online, max: data.players.max };
                    }
                }
            }
        });
        return bestResult;
    }

    async function updateStatus() {
        const statusEl = document.getElementById('server-status');
        const onlineEl = document.getElementById('player-online');
        const maxEl = document.getElementById('player-max');
        const detailBox = document.getElementById('maintenance-detail');
        document.getElementById('server-ip-display').innerText = serverIP;

        const params = new URLSearchParams(window.location.search);
        const isMaintenance = params.get('maintenance') === 'true';
        const reason = params.get('reason');

        if (isMaintenance) {
            statusEl.innerText = 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­';
            statusEl.className = 'indicator offline';
            onlineEl.innerText = '-';
            maxEl.innerText = '-';
            if (reason) {
                detailBox.style.display = 'block';
                document.getElementById('detail-text').innerText = decodeURIComponent(reason);
            }
            return;
        }

        const result = await getStatusWithFallback();
        if (result.online) {
            statusEl.innerText = 'ç¨¼åƒä¸­';
            statusEl.className = 'indicator online';
            onlineEl.innerText = result.players;
            maxEl.innerText = result.max;
        } else {
            statusEl.innerText = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';
            statusEl.className = 'indicator offline';
            onlineEl.innerText = '0';
            maxEl.innerText = '0';
        }
    }

    function copyIP() {
        const el = document.createElement('textarea');
        el.value = serverIP;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);

        const tooltip = document.getElementById('tooltip');
        tooltip.classList.add('show');
        setTimeout(() => tooltip.classList.remove('show'), 2000);
    }

    updateStatus();
    setInterval(updateStatus, 60000);
</script>

</body>
</html>