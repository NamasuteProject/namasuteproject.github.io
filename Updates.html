<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NamasuteProject - ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæƒ…å ±</title>
    <style>
        /* --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOutDown { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }
        
        .animate-in { animation: fadeInUp 0.6s ease-out both; }
        /* æˆ»ã‚‹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¯ãƒ©ã‚¹ */
        .animate-out { animation: fadeOutDown 0.4s ease-in both !important; }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #1a1a1a; color: #e0e0e0; margin: 0;
            display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding-top: 50px;
            overflow-x: hidden;
        }

        .container {
            width: 90%; max-width: 700px; background: #2d2d2d; padding: 2.5rem;
            border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            border-top: 5px solid #3fb0ac; margin-bottom: 50px;
            transition: opacity 0.4s, transform 0.4s;
        }

        /* --- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        .page-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #3d3d3d; padding-bottom: 1.0rem; margin-bottom: 2rem;
        }

        .page-header h1 {
            margin: 0; font-size: 1.5rem; color: #3fb0ac; display: flex; align-items: center;
        }
        .page-header h1::before { content: 'ğŸ› ï¸'; margin-right: 15px; }

        .btn-back-header {
            text-decoration: none; color: #3fb0ac; font-size: 0.85rem; font-weight: bold;
            padding: 6px 14px; border: 1.5px solid #3fb0ac; border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); background: transparent;
            cursor: pointer;
        }
        .btn-back-header:hover {
            background: #3fb0ac; color: #ffffff; transform: translateX(-3px);
            box-shadow: 0 4px 10px rgba(63, 176, 172, 0.3);
        }

        /* --- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆæ›´æ–°å±¥æ­´ï¼‰ --- */
        .update-item {
            position: relative; padding-left: 30px; border-left: 2px solid #3d3d3d;
            margin-bottom: 40px;
        }
        .update-item::before {
            content: ''; position: absolute; left: -7px; top: 0;
            width: 12px; height: 12px; border-radius: 50%; background: #3fb0ac;
            box-shadow: 0 0 10px #3fb0ac;
        }

        .update-date { font-size: 0.85rem; color: #777; font-weight: bold; margin-bottom: 5px; }
        .update-title { font-size: 1.2rem; color: #fff; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        
        .update-content { background: #1e1e1e; padding: 15px; border-radius: 8px; border: 1px solid #3d3d3d; }
        .update-content ul { margin: 0; padding-left: 20px; }
        .update-content li { margin-bottom: 5px; font-size: 0.95rem; }

        /* --- ã‚¿ã‚° --- */
        .tag {
            display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;
            font-weight: bold; text-transform: uppercase;
        }
        .tag-plugin { background: #9b59b6; color: #fff; }
        .tag-fix { background: #e67e22; color: #fff; }
        .tag-new { background: #2ecc71; color: #fff; }
        .tag-news { background: #3498db; color: #fff; }
        .tag-event { background: #ff4757; color: #fff; }
        .tag-issue { background: #f1c40f; color: #000; }
        .tag-maintenance { background: #7f8c8d; color: #fff; }

        /* --- å‹•ç”»å¯¾å¿œ --- */
        .video-container {
            position: relative; width: 100%; padding-top: 56.25%;
            margin: 15px 0; border-radius: 8px; overflow: hidden; background: #000;
        }
        .video-container iframe, .video-container video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;
        }

        /* --- ãƒ•ãƒƒã‚¿ãƒ¼ --- */
        .footer-area { margin-top: 2rem; text-align: center; border-top: 1px solid #3d3d3d; padding-top: 1.5rem; }
        .btn-back-footer { color: #888; text-decoration: none; font-size: 0.9rem; transition: 0.3s; cursor: pointer; }
        .btn-back-footer:hover { color: #3fb0ac; }

        /* å°‘ã—é…ã‚‰ã›ã¦é–‹å§‹ã™ã‚‹ã“ã¨ã§ã€è¦ªãŒæ²ˆã‚€ã®ã¨å…¥ã‚Œæ›¿ã‚ã‚Šã§å‡ºã¦ãã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ */
        .animate-in { 
            animation: fadeInUp 0.6s ease-out both;
            animation-delay: 0.1s; 
        }
    </style>
</head>
<body>

<div class="container animate-in" id="updates-container">
    <div class="page-header">
        <h1>Updates & News</h1>
        <a href="javascript:void(0)" onclick="closePageWithAnimation()" class="btn-back-header">â† æˆ»ã‚‹</a>
    </div>

    <div id="update-list">
        </div>

    <div class="footer-area">
        <a href="javascript:void(0)" onclick="closePageWithAnimation()" class="btn-back-footer">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>
    </div>
</div>

<script>
    // 1. æˆ»ã‚‹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
    function closePageWithAnimation() {
        const container = document.querySelector('.container');
        container.classList.add('animate-out'); // ä¸‹ã«æ¶ˆãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

        setTimeout(() => {
            if (window.parent && window.parent.closePage) {
                window.parent.closePage(); // è¦ªã® closePage() ã‚’å®Ÿè¡Œ
            }
        }, 350);
    }

    // 2. JSONã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤ºã™ã‚‹
    async function loadUpdates() {
        try {
            const response = await fetch('updates.json');
            const data = await response.json();
            const listContainer = document.getElementById('update-list');

            // æœ€æ–°ã®æ—¥ä»˜ã‚’æ—¢èª­ã¨ã—ã¦ä¿å­˜
            if (data.length > 0) {
                const latestDateNum = data[0].date.replace(/\./g, '');
                localStorage.setItem('lastViewedUpdate', latestDateNum);
            }
        
            const tagLabels = {
                "news": "NEWS",
                "plugin": "PLUGIN",
                "fix": "FIX",
                "new": "NEW",
                "event": "EVENT",
                "issue": "ISSUE",
                "maintenance": "MAINTENANCE"
            };
        
            data.forEach((item, index) => {
                const displayTag = tagLabels[item.tag] || item.tag.toUpperCase();

                const contentHtml = item.contents.map(text => {
                    const isVideoFile = text.match(/\.(mp4|webm|mov)(\?.*)?$/i);
                    const youtubeMatch = text.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);

                    if (isVideoFile) {
                        return `<div class="video-container"><video controls playsinline preload="metadata"><source src="${text}" type="video/mp4"></video></div>`;
                    } else if (youtubeMatch) {
                        return `<div class="video-container"><iframe src="https://www.youtube.com/embed/${youtubeMatch[1]}" frameborder="0" allowfullscreen></iframe></div>`;
                    } else {
                        return `<li>${text}</li>`;
                    }
                }).join('');
            
                const updateHtml = `
                    <div class="update-item animate-in" style="animation-delay: ${0.1 * (index + 1)}s">
                        <div class="update-date">${item.date}</div>
                        <div class="update-title">
                            <span class="tag tag-${item.tag}">${displayTag}</span>
                            ${item.title}
                        </div>
                        <div class="update-content">
                            <ul>${contentHtml}</ul>
                        </div>
                    </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', updateHtml);
            });
        } catch (error) {
            console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
            document.getElementById('update-list').innerHTML = "<p>ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæƒ…å ±ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>";
        }
    }

    loadUpdates();
</script>

</body>
</html>